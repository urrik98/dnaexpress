"use strict";angular.module("app.eventfactory",[]).factory("eventFactory",["$http","$state","$window",function(e,t,s){var a=[],n={},r=[],o=[],i=function(e){var t="L";for(var s in e)"L"===t?(r.push(e[s]),t="R"):(o.push(e[s]),t="L")},u=function(s){return t.go("loading"),e({method:"POST",url:"api/events/create",data:s}).then(function(e){return c(e),e}).then(function(){t.go("dashboard.showevent")})["catch"](function(e){console.error("Error received in createEvent",e)})},c=function(e){s.sessionStorage.removeItem("wefeast.user.events"),s.sessionStorage.setItem("wefeast.user.events",JSON.stringify(e.data))},f=function(s){return t.go("loading"),e({method:"POST",url:"api/events/formsubmission",data:s}).then(function(e){return c(e),e}).then(function(){t.go("dashboard.showevent")})["catch"](function(e){console.error("Error received in sendEventResponse",e)})},l=function(){return e({method:"POST",url:"api/events/getevents",data:{username:s.sessionStorage.getItem("wefeast.user.username")}}).then(function(e){c(e)})["catch"](function(e){console.log(e)})},m=function(s){return e({method:"POST",url:"api/events/decline",data:s}).then(function(e){return c(e),e}).then(function(){t.go("dashboard.showevent")})["catch"](function(e){console.log(e)})},g=function(s){return e({method:"POST",url:"api/events/selectrestaurant",data:s}).then(function(e){return c(e),e}).then(function(){t.go("dashboard.showevent")})["catch"](function(e){console.log(e)})};return{guestList:a,createEvent:u,eventData:n,distributeGuestList:i,databinLeft:r,databinRight:o,liveEventDataHandler:c,sendEventResponse:f,fetchEvents:l,declineInvite:m,selectRestaurant:g}}]),angular.module("app.guestuserservices",[]).factory("GuestFactory",["$http","$state","$window",function(e,t,s){var a=function(a){return console.log("sent from factory",a),e({url:"api/guestusers/getevents",method:"POST",data:a}).then(function(e){console.log(e.data.data),s.sessionStorage.setItem("wefeast.guestuserevents",JSON.stringify(e.data.data)),t.go("guestuserdashboard.guestuseroptions.guestusershowevents")})},n=function(t){console.log(t),t.invitees=[],t.invitees.push(t.hostemail);for(var s in t)/guest/.test(s)&&t[s]&&t.invitees.push(t[s]);return e({url:"/api/guestusers/createevent",method:"POST",data:t}).then(function(e){console.log("response",e.data.data)})},r=function(t){return e({url:"api/guestusers/sendresponse",method:"POST",data:t}).then(function(e){console.log("response",e)})};return{createEvent:n,eventResponse:r,getEvents:a}}]),angular.module("app.services",["app.eventfactory"]).factory("userFactory",["$http","$state",function(e,t){var s=function(t){return e({method:"POST",url:"/api/search",data:t}).then(function(e){return e})};return{userReq:s}}]).factory("restaurantFactory",[function(){var e,t=[],s=[];return{restaurants:e,databinLeft:t,databinRight:s}}]).factory("Profile",["$state","$http","$window",function(e,t,s){var a=function(e,t){t||(t={});var s=t.username||e.username,a=t.firstname||e.firstname,n=t.lastname||e.lastname,r=t.email||e.email,o=(t.location||e.location,{username:s,firstname:a,lastname:n,email:r,password:e.password,location:e.location,restrictions:[],preferences:[]});for(var i in t)"boolean"==typeof t[i]&&("vegetarian"===i||"vegan"===i||"glutenFree"===i||"kosher"===i?o.restrictions.push(i):o.preferences.push(i));return o},n=function(a){return t({method:"POST",url:"/api/users/profile",data:a}).then(function(t){s.sessionStorage.setItem("wefeast.user.username",t.data.user.username),s.sessionStorage.setItem("wefeast.user.first",t.data.user.firstname),s.sessionStorage.setItem("wefeast.user.last",t.data.user.lastname),s.sessionStorage.setItem("wefeast.user.location",t.data.user.location),s.sessionStorage.setItem("wefeast.user.email",t.data.user.email),s.sessionStorage.setItem("wefeast.user.preferences",JSON.stringify(t.data.user.preferences)),s.sessionStorage.setItem("wefeast.user.dietrestrictions",JSON.stringify(t.data.user.restrictions)),e.go("dashboard.profile")})},r=function(a){return t({method:"POST",url:"/api/users/profile",data:a}).then(function(t){s.sessionStorage.setItem("wefeast.user.username",t.data.user.username),s.sessionStorage.setItem("wefeast.user.first",t.data.user.firstname),s.sessionStorage.setItem("wefeast.user.last",t.data.user.lastname),s.sessionStorage.setItem("wefeast.user.location",t.data.user.location),s.sessionStorage.setItem("wefeast.user.email",t.data.user.email),s.sessionStorage.setItem("wefeast.user.preferences",JSON.stringify(t.data.user.preferences)),s.sessionStorage.setItem("wefeast.user.dietrestrictions",JSON.stringify(t.data.user.restrictions)),e.go("dashboard.createevent")})};return{processData:a,sendEditProfile:n,sendCreateProfile:r}}]).factory("Auth",["$http","$state","$window","eventFactory",function(e,t,s,a){var n={},r=function(t){return e({method:"POST",url:"/api/users/signin",data:t}).then(function(e){return s.localStorage.setItem("com.app",e.data.token),s.sessionStorage.setItem("wefeast.user.username",e.data.user.username),s.sessionStorage.setItem("wefeast.user.first",e.data.user.firstname),s.sessionStorage.setItem("wefeast.user.last",e.data.user.lastname),s.sessionStorage.setItem("wefeast.user.location",e.data.user.location),s.sessionStorage.setItem("wefeast.user.email",e.data.user.email),s.sessionStorage.setItem("wefeast.user.preferences",JSON.stringify(e.data.user.preferences)),s.sessionStorage.setItem("wefeast.user.dietrestrictions",JSON.stringify(e.data.user.dietRestrictions)),s.sessionStorage.setItem("wefeast.userList",JSON.stringify(e.data.allUsers)),s.sessionStorage.setItem("wefeast.user.events",JSON.stringify(e.data.user.events)),e})["catch"](function(e){console.error(e)})},o=function(t){return e({method:"POST",url:"/api/users/signup",data:t}).then(function(e){return s.localStorage.setItem("com.app",e.data.token),s.sessionStorage.setItem("wefeast.user.username",e.data.user.username),s.sessionStorage.setItem("wefeast.user.first",e.data.user.firstname),s.sessionStorage.setItem("wefeast.user.last",e.data.user.lastname),s.sessionStorage.setItem("wefeast.user.location",e.data.user.location),s.sessionStorage.setItem("wefeast.user.email",e.data.user.email),s.sessionStorage.setItem("wefeast.user.preferences",JSON.stringify(e.data.user.preferences)),s.sessionStorage.setItem("wefeast.user.dietrestrictions",JSON.stringify(e.data.user.dietRestrictions)),s.sessionStorage.setItem("wefeast.userList",JSON.stringify(e.data.allUsers)),e.data.token})["catch"](function(e){console.error(e)})},i=function(){return!!s.localStorage.getItem("com.app")},u=function(){s.localStorage.removeItem("com.app"),s.sessionStorage.removeItem("wefeast.user.username"),s.sessionStorage.removeItem("wefeast.user.first"),s.sessionStorage.removeItem("wefeast.user.last"),s.sessionStorage.removeItem("wefeast.user.location"),s.sessionStorage.removeItem("wefeast.user.email"),s.sessionStorage.removeItem("userList"),s.sessionStorage.removeItem("wefeast.userList"),s.sessionStorage.removeItem("wefeast.user.dietrestrictions"),s.sessionStorage.removeItem("wefeast.user.preferences"),s.sessionStorage.removeItem("wefeast.user.events")};return{signin:r,signup:o,isAuth:i,signout:u,userData:n}}]),angular.module("app.auth",["app.services","app.eventfactory"]).controller("AuthCtrl",["$scope","$state","$window","Auth","Profile","eventFactory",function(e,t,s,a,n,r){function o(e){var t=!0;for(var s in e){e[s];if("email"!==s){var a=e[s].search(/\W/g);a>-1&&(t=!1)}}return t}e.reset=function(e){e&&(e.$setPristine(),e.$setUntouched())},e.signin=function(){var n=o(e.user);n?a.signin(e.user).then(function(a){a.data.token?(s.localStorage.setItem("com.app",a.data.token),t.go("dashboard.showevent")):(alert("email / password not recognized"),e.reset(),t.go("main.signin"))})["catch"](function(e){console.error(e)}):alert("Please use only letters and numbers. Emails should contain an '@' and a '.'")},e.advanceToFoodPrefs=function(){t.go("main.createprofile",{user:e.user})},e.signup=function(){var r=n.processData(e.user),i=o(e.user);i?a.signup(r).then(function(a){s.localStorage.setItem("com.app",a),t.go("dashboard.createprofile",{user:e.user})})["catch"](function(e){console.error(e)}):alert("Please use only letters and numbers. Emails should contain an '@' and a '.'")}}]),angular.module("app.createevent",["app.services","app.eventfactory"]).controller("CreateEventCtrl",["$scope","$state","$window","userFactory","eventFactory",function(e,t,s,a,n){e.databinLeft=[],e.databinRight=[],e.event={},e.allUsersList=JSON.parse(s.sessionStorage.getItem("wefeast.userList")),e.event.creator=s.sessionStorage.getItem("wefeast.user.username");var r="L";for(var o in e.allUsersList)"L"===r?(e.databinLeft.push(e.allUsersList[o]),r="R"):(e.databinRight.push(e.allUsersList[o]),r="L");e.guests={},e.eventData=n.eventData,e.guestbin=[],e.addToGuestList=function(t){e.guestbin.indexOf(t)<0&&e.guestbin.push(t)},e.removeFromGuestList=function(t){e.guestbin.indexOf(t)>-1&&e.guestbin.splice(e.guestbin.indexOf(t),1)},e.addGuestsToEventData=function(){n.eventData.attendees=e.guestbin,t.go("dashboard.createeventreview")},e.collectEventData=function(){n.eventData.eventName=e.event.name,n.eventData.creator=e.event.creator,n.eventData.date=e.event.date,n.eventData.location=e.event.location,t.go("dashboard.guestlist")},e.submitEvent=function(){n.createEvent(n.eventData)}}]),angular.module("app.createprofile",["app.services"]).controller("CreateProfileCtrl",["$scope","$state","$stateParams","Auth","Profile","$window",function(e,t,s,a,n,r){e.user={},e.user.username=r.sessionStorage.getItem("wefeast.user.username"),e.user.firstname=r.sessionStorage.getItem("wefeast.user.first"),e.user.lastname=r.sessionStorage.getItem("wefeast.user.last"),e.user.location=r.sessionStorage.getItem("wefeast.user.location"),e.user.email=r.sessionStorage.getItem("wefeast.user.email"),e.activate=function(t){var s=n.processData(e.user,t);n.sendCreateProfile(s)}}]),angular.module("app.dashboard",["app.services"]).controller("DashboardCtrl",["$scope","$state","Auth",function(e,t,s){e.signout=function(){s.signout(),t.go("main")}}]),angular.module("app.editprofile",["app.services"]).controller("EditProfileCtrl",["$state","$scope","Profile","Auth","$window",function(e,t,s,a,n){t.user={},t.user.username=n.sessionStorage.getItem("wefeast.user.username"),t.user.firstname=n.sessionStorage.getItem("wefeast.user.first"),t.user.lastname=n.sessionStorage.getItem("wefeast.user.last"),t.user.location=n.sessionStorage.getItem("wefeast.user.location"),t.user.email=n.sessionStorage.getItem("wefeast.user.email"),t.activate=function(e){var a=s.processData(t.user,e);s.sendEditProfile(a)}}]),angular.module("app.guestuser",["app.guestuserservices"]).controller("GuestUserCtrl",["$scope","$state","$window","GuestFactory",function(e,t,s,a){function n(e){a.getEvents(e),t.go("loading")}function r(){for(var e="",t=[1,2,3,4,5,6,7,8,9,0,"a","b","c","d","e","f"],s=0;s<t.length;s++)e+=t[Math.floor(Math.random()*t.length)];return e}e.showEventsList=!0,e.showFocusEvent=!1,e.showResponseForm=!1,e.toggleFocusEvent=function(t){t&&(e.focusEvent=t),e.showEventsList=!1,e.showFocusEvent=!0,e.showResponseForm=!1},e.toggleEventsList=function(){e.showEventsList=!0,e.showFocusEvent=!1,e.showResponseForm=!1},e.toggleResponseForm=function(){e.showEventsList=!1,e.showFocusEvent=!1,e.showResponseForm=!0},e.focusEvent,e.responseform;var o=!0,i=!0;e.guestUserEmail=s.sessionStorage.getItem("wefeast.guestuser"),e.eventsBin=JSON.parse(s.sessionStorage.getItem("wefeast.guestuserevents"))||[],e.submitResponse=function(t){if(console.log("inside submitResponse",t),i){i=!1;var n=[];for(var r in t)n.push(r);e.focusEvent.responded=!0,e.focusEvent.food_choice=n[0],console.log("submit response data",t),console.log("$scope.guestUserEmail",e.guestUserEmail,"data.hostemail",t.hostemail),e.focusEvent.email=e.guestUserEmail||t.hostemail,console.log("$scope.focusEvent.email",e.focusEvent.email),s.sessionStorage.removeItem("wefeast.guestuserevents"),s.sessionStorage.setItem("wefeast.guestuserevents",JSON.stringify(e.eventsBin)),a.eventResponse(e.focusEvent),e.toggleEventsList()}i=!0},e.guestUserEventSubmit=function(){if(o){o=!1,e.guestEvent.publicID=r(),e.guestEvent.responded=!1,e.eventsBin.push(e.guestEvent),console.log("guestEvent",e.guestEvent),s.sessionStorage.getItem("wefeast.guestuser")||s.sessionStorage.setItem("wefeast.guestuser",e.guestEvent.hostemail);var n=e.guestEvent;s.sessionStorage.removeItem("wefeast.guestuserevents"),s.sessionStorage.setItem("wefeast.guestuserevents",JSON.stringify(e.eventsBin)),a.createEvent(n),t.go("loading"),t.go("guestuserdashboard.guestuseroptions.guestusershowevents")}},e.setGuestUser=function(t){s.sessionStorage.removeItem("wefeast.guestuserevents"),n({email:t}),s.sessionStorage.getItem("wefeast.guestuser")||(e.guestUserEmail=t),s.sessionStorage.setItem("wefeast.guestuser",t)}}]),angular.module("app.main",["app.services"]).controller("MainCtrl",["$scope","$state","Auth",function(e,t,s){function a(){for(var e=[0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"],t="",s=0;s<e.length;s++)t+=e[Math.floor(Math.random()*e.length)];console.log(t)}e.userIsLive=!1,e.userClicked=function(){e.userIsLive=!0},e.activateGuestExperience=function(){a()}}]),angular.module("app.optionform",["app.services"]).controller("OptionformCtrl",["$scope","$location","$state","userFactory","restaurantFactory",function(e,t,s,a,n){e.formData={},e.formData.Array=[],e.toggleChoice=function(t){0===e.formData.Array.length?e.formData.Array.push(t):e.formData.Array=[]},e.search=function(t){var r;for(var o in e.formData)e.formData[o]===!0&&(r=o);var i={opt1:r,location:t.location};s.go("loading"),a.userReq(i).then(function(e){if(200===e.status){n.databinLeft=[],n.databinRight=[];for(var t=0;t<e.data.slice(0,16).length;t++)t%2===0?e.data[t].image_url&&n.databinLeft.push(e.data[t]):e.data[t].image_url&&n.databinRight.push(e.data[t]);s.go("dashboard.restaurantResults")}else s.go("dashboard.noresultsview")})}}]),angular.module("app.profile",["app.services"]).controller("ProfileCtrl",["$scope","$state","$window",function(e,t,s){for(var a=JSON.parse(s.sessionStorage.getItem("wefeast.user.preferences")),n="",r=0;r<a.length;r++)n=n+a[r]+", ";n=n?n.slice(0,-2):"none";for(var o=JSON.parse(s.sessionStorage.getItem("wefeast.user.dietrestrictions")),i="",r=0;r<o.length;r++)i=i+o[r]+", ";i=i?i.slice(0,-2):"none",e.user={},e.user.username=s.sessionStorage.getItem("wefeast.user.username"),e.user.firstname=s.sessionStorage.getItem("wefeast.user.first"),e.user.lastname=s.sessionStorage.getItem("wefeast.user.last"),e.user.location=s.sessionStorage.getItem("wefeast.user.location"),e.user.email=s.sessionStorage.getItem("wefeast.user.email"),e.user.preferences=n,e.user.dietrestrictions=i}]),angular.module("app.responseform",["app.eventfactory"]).controller("ResponseFormCtrl",["$scope","$state","$stateParams","$window","eventFactory",function(e,t,s,a,n){e.eventData=s.eventData,e.sendResponse=function(t){if(e.decline){var s={pubId:e.eventData.publicEventId,username:a.sessionStorage.getItem("wefeast.user.username")};n.declineInvite(s)}else{e.responseform={};var r=[];for(var o in t)t[o]&&r.push(o);var i={pubEventId:e.eventData.publicEventId,username:a.sessionStorage.getItem("wefeast.user.username"),prefs:r,decline:0};n.sendEventResponse(i)}}}]),angular.module("app.restaurantresults",[]).controller("RestaurantResultsCtrl",["$scope","restaurantFactory",function(e,t){e.data={restaurants:t.restaurants},e.databinLeft=t.databinLeft,e.databinRight=t.databinRight}]),angular.module("app.showevent",["app.eventfactory"]).controller("ShowEventCtrl",["$scope","$window","$stateParams","eventFactory",function(e,t,s,a){a.fetchEvents(),e.eventBinLeft=[],e.eventBinCenter=[],e.eventBinRight=[],e.singleEvent=s.singleevent,e.recommendationsBinLeft=[],e.recommendationsBinCenter=[],e.recommendationsBinRight=[],e.recommendations=JSON.parse(t.sessionStorage.getItem("wefeast.temp.recommendations")),e.noEventsNotice="No Events To Display",e.allEventList=JSON.parse(t.sessionStorage.getItem("wefeast.user.events")),e.userIsEventCreator=function(e){return e.creator===t.sessionStorage.getItem("wefeast.user.username")},e.setRecommendations=function(e){t.sessionStorage.removeItem("wefeast.temp.focusevent"),t.sessionStorage.setItem("wefeast.temp.focusevent",JSON.stringify(e)),t.sessionStorage.removeItem("wefeast.temp.recommendations"),t.sessionStorage.setItem("wefeast.temp.recommendations",JSON.stringify(e.recommendations))},e.selectRecommendation=function(e){t.sessionStorage.removeItem("wefeast.selection"),t.sessionStorage.setItem("wefeast.selection",JSON.stringify(e))},e.selection=JSON.parse(t.sessionStorage.getItem("wefeast.selection")),e.finalChoice=function(e){var s=JSON.parse(t.sessionStorage.getItem("wefeast.temp.focusevent")),n={creator:s.creator,pubEventId:s.publicEventId,restaurant:e.name};a.selectRestaurant(n)};var n="L";if(e.allEventList&&e.allEventList.length>0)for(var r=0;r<e.allEventList.length;r++)"L"===n?(e.eventBinLeft.push(e.allEventList[r]),n="C"):"C"===n?(e.eventBinCenter.push(e.allEventList[r]),n="R"):(e.eventBinRight.push(e.allEventList[r]),n="L");else e.allEventList=null;var o="L";if(e.recommendations&&e.recommendations.length>0)for(var i=0;i<e.recommendations.length;i++)"L"===o?(e.recommendationsBinLeft.push(e.recommendations[i]),o="C"):"C"===o?(e.recommendationsBinCenter.push(e.recommendations[i]),o="R"):(e.recommendationsBinRight.push(e.recommendations[i]),o="L")}]);