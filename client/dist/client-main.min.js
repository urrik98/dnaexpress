"use strict";angular.module("app.auth",["app.services","app.eventfactory"]).controller("AuthCtrl",["$scope","$state","$window","Auth","Profile","eventFactory",function(e,t,s,a,n,r){function o(e){var t=!0;for(var s in e){e[s];if("email"!==s){var a=e[s].search(/\W/g);a>-1&&(t=!1)}}return t}e.reset=function(e){e&&(e.$setPristine(),e.$setUntouched())},e.signin=function(){var n=o(e.user);n?a.signin(e.user).then(function(a){a.data.token?(s.localStorage.setItem("com.app",a.data.token),t.go("dashboard.showevent")):(alert("email / password not recognized"),e.reset(),t.go("main.signin"))})["catch"](function(e){console.error(e)}):alert("Please use only letters and numbers. Emails should contain an '@' and a '.'")},e.advanceToFoodPrefs=function(){t.go("main.createprofile",{user:e.user})},e.signup=function(){var r=n.processData(e.user),i=o(e.user);i?a.signup(r).then(function(a){s.localStorage.setItem("com.app",a),t.go("dashboard.createprofile",{user:e.user})})["catch"](function(e){console.error(e)}):alert("Please use only letters and numbers. Emails should contain an '@' and a '.'")}}]),angular.module("app.createevent",["app.services","app.eventfactory"]).controller("CreateEventCtrl",["$scope","$state","$window","userFactory","eventFactory",function(e,t,s,a,n){e.databinLeft=[],e.databinRight=[],e.event={},e.allUsersList=JSON.parse(s.sessionStorage.getItem("wefeast.userList")),e.event.creator=s.sessionStorage.getItem("wefeast.user.username");var r="L";for(var o in e.allUsersList)"L"===r?(e.databinLeft.push(e.allUsersList[o]),r="R"):(e.databinRight.push(e.allUsersList[o]),r="L");e.guests={},e.eventData=n.eventData,e.guestbin=[],e.addToGuestList=function(t){e.guestbin.indexOf(t)<0&&e.guestbin.push(t)},e.removeFromGuestList=function(t){e.guestbin.indexOf(t)>-1&&e.guestbin.splice(e.guestbin.indexOf(t),1)},e.addGuestsToEventData=function(){n.eventData.attendees=e.guestbin,t.go("dashboard.createeventreview")},e.collectEventData=function(){n.eventData.eventName=e.event.name,n.eventData.creator=e.event.creator,n.eventData.date=e.event.date,n.eventData.location=e.event.location,t.go("dashboard.guestlist")},e.submitEvent=function(){n.createEvent(n.eventData)}}]),angular.module("app.createprofile",["app.services"]).controller("CreateProfileCtrl",["$scope","$state","$stateParams","Auth","Profile","$window",function(e,t,s,a,n,r){e.user={},e.user.username=r.sessionStorage.getItem("wefeast.user.username"),e.user.firstname=r.sessionStorage.getItem("wefeast.user.first"),e.user.lastname=r.sessionStorage.getItem("wefeast.user.last"),e.user.location=r.sessionStorage.getItem("wefeast.user.location"),e.user.email=r.sessionStorage.getItem("wefeast.user.email"),e.activate=function(t){var s=n.processData(e.user,t);n.sendCreateProfile(s)}}]),angular.module("app.dashboard",["app.services"]).controller("DashboardCtrl",["$scope","$state","Auth",function(e,t,s){e.signout=function(){s.signout(),t.go("main")}}]),angular.module("app.editprofile",["app.services"]).controller("EditProfileCtrl",["$state","$scope","Profile","Auth","$window",function(e,t,s,a,n){t.user={},t.user.username=n.sessionStorage.getItem("wefeast.user.username"),t.user.firstname=n.sessionStorage.getItem("wefeast.user.first"),t.user.lastname=n.sessionStorage.getItem("wefeast.user.last"),t.user.location=n.sessionStorage.getItem("wefeast.user.location"),t.user.email=n.sessionStorage.getItem("wefeast.user.email"),t.activate=function(e){var a=s.processData(t.user,e);s.sendEditProfile(a)}}]),angular.module("app.guestuser",[]).controller("GuestUserCtrl",["$scope",function(e){}]),angular.module("app.main",["app.services"]).controller("MainCtrl",["$scope","$state","Auth",function(e,t,s){function a(){for(var e=[0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"],t="",s=0;s<e.length;s++)t+=e[Math.floor(Math.random()*e.length)];console.log(t)}e.userIsLive=!1,e.userClicked=function(){e.userIsLive=!0},e.activateGuestExperience=function(){a()}}]),angular.module("app.optionform",["app.services"]).controller("OptionformCtrl",["$scope","$location","$state","userFactory","restaurantFactory",function(e,t,s,a,n){e.formData={},e.formData.Array=[],e.toggleChoice=function(t){0===e.formData.Array.length?e.formData.Array.push(t):e.formData.Array=[]},e.search=function(t){var r;for(var o in e.formData)e.formData[o]===!0&&(r=o);var i={opt1:r,location:t.location};s.go("loading"),a.userReq(i).then(function(e){if(200===e.status){n.databinLeft=[],n.databinRight=[];for(var t=0;t<e.data.slice(0,16).length;t++)t%2===0?e.data[t].image_url&&n.databinLeft.push(e.data[t]):e.data[t].image_url&&n.databinRight.push(e.data[t]);s.go("dashboard.restaurantResults")}else s.go("dashboard.noresultsview")})}}]),angular.module("app.profile",["app.services"]).controller("ProfileCtrl",["$scope","$state","$window",function(e,t,s){for(var a=JSON.parse(s.sessionStorage.getItem("wefeast.user.preferences")),n="",r=0;r<a.length;r++)n=n+a[r]+", ";n=n?n.slice(0,-2):"none";for(var o=JSON.parse(s.sessionStorage.getItem("wefeast.user.dietrestrictions")),i="",r=0;r<o.length;r++)i=i+o[r]+", ";i=i?i.slice(0,-2):"none",e.user={},e.user.username=s.sessionStorage.getItem("wefeast.user.username"),e.user.firstname=s.sessionStorage.getItem("wefeast.user.first"),e.user.lastname=s.sessionStorage.getItem("wefeast.user.last"),e.user.location=s.sessionStorage.getItem("wefeast.user.location"),e.user.email=s.sessionStorage.getItem("wefeast.user.email"),e.user.preferences=n,e.user.dietrestrictions=i}]),angular.module("app.responseform",["app.eventfactory"]).controller("ResponseFormCtrl",["$scope","$state","$stateParams","$window","eventFactory",function(e,t,s,a,n){e.eventData=s.eventData,e.sendResponse=function(t){if(e.decline){var s={pubId:e.eventData.publicEventId,username:a.sessionStorage.getItem("wefeast.user.username")};n.declineInvite(s)}else{e.responseform={};var r=[];for(var o in t)t[o]&&r.push(o);var i={pubEventId:e.eventData.publicEventId,username:a.sessionStorage.getItem("wefeast.user.username"),prefs:r,decline:0};n.sendEventResponse(i)}}}]),angular.module("app.restaurantresults",[]).controller("RestaurantResultsCtrl",["$scope","restaurantFactory",function(e,t){e.data={restaurants:t.restaurants},e.databinLeft=t.databinLeft,e.databinRight=t.databinRight}]),angular.module("app.showevent",["app.eventfactory"]).controller("ShowEventCtrl",["$scope","$window","$stateParams","eventFactory",function(e,t,s,a){a.fetchEvents(),e.eventBinLeft=[],e.eventBinCenter=[],e.eventBinRight=[],e.singleEvent=s.singleevent,e.recommendationsBinLeft=[],e.recommendationsBinCenter=[],e.recommendationsBinRight=[],e.recommendations=JSON.parse(t.sessionStorage.getItem("wefeast.temp.recommendations")),e.noEventsNotice="No Events To Display",e.allEventList=JSON.parse(t.sessionStorage.getItem("wefeast.user.events")),e.userIsEventCreator=function(e){return e.creator===t.sessionStorage.getItem("wefeast.user.username")},e.setRecommendations=function(e){t.sessionStorage.removeItem("wefeast.temp.focusevent"),t.sessionStorage.setItem("wefeast.temp.focusevent",JSON.stringify(e)),t.sessionStorage.removeItem("wefeast.temp.recommendations"),t.sessionStorage.setItem("wefeast.temp.recommendations",JSON.stringify(e.recommendations))},e.selectRecommendation=function(e){t.sessionStorage.removeItem("wefeast.selection"),t.sessionStorage.setItem("wefeast.selection",JSON.stringify(e))},e.selection=JSON.parse(t.sessionStorage.getItem("wefeast.selection")),e.finalChoice=function(e){var s=JSON.parse(t.sessionStorage.getItem("wefeast.temp.focusevent")),n={creator:s.creator,pubEventId:s.publicEventId,restaurant:e.name};a.selectRestaurant(n)};var n="L";if(e.allEventList&&e.allEventList.length>0)for(var r=0;r<e.allEventList.length;r++)"L"===n?(e.eventBinLeft.push(e.allEventList[r]),n="C"):"C"===n?(e.eventBinCenter.push(e.allEventList[r]),n="R"):(e.eventBinRight.push(e.allEventList[r]),n="L");else e.allEventList=null;var o="L";if(e.recommendations&&e.recommendations.length>0)for(var i=0;i<e.recommendations.length;i++)"L"===o?(e.recommendationsBinLeft.push(e.recommendations[i]),o="C"):"C"===o?(e.recommendationsBinCenter.push(e.recommendations[i]),o="R"):(e.recommendationsBinRight.push(e.recommendations[i]),o="L")}]);